---
title: "SEM"
author: "Oksana Efron, Keri Gagnow, Sabrina Hassan"
date: "2025-12-04"
output: html_document
---
### Student Depression Dataset
###1. Load Relevant R Libraries
```{r}
library(readr)
library(ggplot2)
library(psych)
library(corrplot)
library(lavaan)
library(png)
library(knitr)
```


### Viewing and Preparing the Dataset
### 2. Loading the Dataset
```{r}
student_depression_dataset_CSV_in_ <- read_csv("student_depression_dataset_CSV(in).csv")

# Keeping first 70 rows and relevant columns
StudentDep <- student_depression_dataset_CSV_in_[1:70, c("Gender", "Age", "City", "Profession", "Academic_Pressure", "Work_Pressure", "CGPA", "Study_Satisfaction", "Job_Satisfaction", "Sleep_Duration", "Dietary_Habits", "Degree", "Suicidal_Thoughts", "Work/Study_Hours", "Financial_Stress", "Family_History_of_Mental_Illness", "Depression")]

dim(StudentDep)
StudentDep
```
Summary of Data Preparation
We located a dataset examining mental-health predictors among students. After importing the file, we restricted the sample to 70 cases and 17 variables for consistency and clarity in later analysis.

### Variable Recoding
### 3. Converting Categorical Variables to Numerical Variables
```{r}
# Making sure to change Gender to binary so its Males = 1, and Female = 0
StudentDep$Gender <- ifelse(StudentDep$Gender == "Male", 1, 0)

# Also doing this for Family History of Mental Illness converting, binary (Yes = 1, No = 0)
StudentDep$Family_History_of_Mental_Illness <- ifelse(StudentDep$Family_History_of_Mental_Illness == "Yes", 1, 0)

# Converting ordinal variables for Dietary Habits and Sleep Duration
StudentDep$Dietary_Habits <- as.numeric(factor(StudentDep$Dietary_Habits,
                                                  levels = c("Unhealthy", "Moderate", "Healthy"),
                                                  ordered = TRUE))
StudentDep$Sleep_Duration <- as.numeric(factor(StudentDep$Sleep_Duration,
                                                  levels = c("'Less than 5 hours'", "'5-6 hours'", "'7-8 hours'", "'More than 8 hours'"),
                                                  ordered = TRUE))

str(StudentDep)
```
Explanation
Categorical variables (example: Gender, Family History of Mental Illness) were converted into binary form. Ordinal variables (example: Dietary Habits, Sleep Duration) were converted using ordered numeric factors to preserve ranking information.

### Descriptive Statistics
### 4. Summary Output
```{r}
summary(StudentDep)
dim(StudentDep)
```

### Exploratory Visualizations
### 5. Bar Plots for Key Variables
```{r}
ggplot(StudentDep) + geom_bar(aes(x = Academic_Pressure))
```

### 5.1
```{r}
ggplot(StudentDep) + geom_bar(aes(x = Study_Satisfaction))
```
Notes
Simple barplots help visualize the distribution of pressure and satisfaction measures.



### 6. Defing Predictors and Responses
```{r}
# Predictor Variables
X <- StudentDep[, c("Gender", "Age", "Academic_Pressure", "Work_Pressure",
                    "CGPA", "Dietary_Habits", "Financial_Stress",
                    "Family_History_of_Mental_Illness")]
# Response Variables
Y <- StudentDep[, c("Depression", "Study_Satisfaction", "Job_Satisfaction", "Sleep_Duration")]
```
Explanation
Predictors (X) includes demographic and stress-related variables. Responses (Y) include depression, satisfaction measures, and sleep duration.


### Skewness and Kurtosis
### 7. Defining Custom Functions
```{r}
# Defining skewness and kurtosis
Skewness <- function(x) {
  n <- length(x)
  m3 <- sum((x - mean(x))^3)/n
  s3 <- sd(x)^3
}

kurtosis <- function(x) {
  n <- length(x)
  m4 <- sum((x - mean(x))^4)/n
  s4 <- sd(x)^4
  m4/s4
}


summary(StudentDep)


```

### 7.1 Summary Stats Table
```{r}
# Calculating mean, Standard Deviation, Skewness, and Kurtosis
Vals <- sapply(StudentDep, is.numeric)
Data <- StudentDep[, Vals]

# Removing NA
Data <- Data[, colSums(is.na(Data)) < nrow(Data)]

SumStats <- data.frame(
  variable = colnames(Data),
  Mean = sapply(Data, mean),
  SD = sapply(Data, sd),
  Skewness = sapply(Data, Skewness),
  Kurtosis = sapply(Data, kurtosis)
)
print(SumStats)

```

### 8. Covariance, Correlation, and Scatterplots
```{r}
# Covariance Matrix
Covar <- cov(Data)
print("Covariance Matrix:")
Covar

# Correlation Matrix
Corr <- cor(Data, use = "pairwise.complete.obs")

print("Correlation Matrix:")
Corr
```

### 8.1
```{r}
# Scatter Plot
pairs(Data, pch = 19, main = "Scatter Plot")
```

### 8.2
```{r}
# Correlation Plot
corrplot(Corr,na.label = " ", method = "circle")
```

### 8.3
```{r}
pairs(Data, pch = 19, main = "Scatter matrix for outliers")
```
Notes
The strongest relationship in the correlation matrix was between academic pressure and depression, indicating that higher academic pressure is associated with higher depressive symptoms. Most other correlations were weak, suggesting minimal shared variance among the remaining variables.

### 9. Outlier Detection via Mahalanobis Distance
```{r}
# Mahalanobis distance
Data <- Data[, apply(Data, 2, var) != 0]
Data <- na.omit(Data)

center <- colMeans(Data)
Covar <- cov(Data)

mahalDist <- mahalanobis(Data, center, Covar)
Data$mahalanobis <- mahalDist

# Identify Outliers
CutOff <- qchisq(0.975, df = ncol(Data) - 1)
Outliers <- which(mahalDist > CutOff)
Outliers
```
Interpretation
Scatterplots and Mahalanobis distances were used to identify multivariate outliers. A few values appear extreme and influence correlaations.

### Principal Component Analysis (PCA)
### 10 Preparing Numeric Predictors and Responses
```{r}
# Predictor Variables
X <- StudentDep[, c("Gender", "Age", "Academic_Pressure", "CGPA", "Dietary_Habits", "Financial_Stress", "Family_History_of_Mental_Illness")]

# Response Variables
Y <- StudentDep[, c("Depression", "Study_Satisfaction", "Job_Satisfaction", "Sleep_Duration")]

# Converting to numeric variables
X[] <- lapply(X, function(col) as.numeric((col)))
Y[] <- lapply(Y, function(col) as.numeric((col)))

# Removing rows with NA
X <- na.omit(X)
Y <- na.omit(Y)

# Keeping columns with zero variance
vars <- sapply(X, var, na.rm = TRUE)
X <- X[, vars > 0]
varsY <- sapply(Y, var, na.rm = TRUE)
Y <- Y[, !is.na(varsY) & varsY > 0]

Y
```


### 10.1 Correlation Matrices and Eigenvalues
```{r}
# Correlation matrices
RX <- cor(X, use = "pairwise.complete.obs")
RY <- cor(Y, use = "pairwise.complete.obs")

# Eigenvalues
EigX <- eigen(RX)
EigY <- eigen(RY)

EigX$values
EigY$values

```

We will be using the Principal Component Analysis to see if an oblique or orthogonal rotation will be necessary for this data set. We will be setting our intrinsic dimensionality to be 4 for the Predictors, note that we were not able to find the loading matrices for the response variables as they were returning 0 despite all attempts

### PCA with Orthogonal and Oblique Rotation
### 11 Orthogonal (Varimax)
```{r}
R <- pca(r = RX, nfactors = 3, rotate = "varimax")$loadings[]
R1 <- pca(r = RY, nfactors = 3, rotate = "varimax")$loadings[]
print("Orthogonal Rotation :")
R
R1
```

### 11.1 Oblique (Oblimin)
```{r}
R_1 <- pca(r = RX, nfactors = 4, rotate = "oblimin")$loadings[]
R_2 <- pca(r = RY, nfactors = 3, rotate = "oblimin")$loadings[]
print("Oblique Rotation :")
R_1
R_2
```

### 11.2 Visualizing Loading Patterns
```{r}
corrplot(R, method = "circle")
corrplot(R1, method = "circle")
corrplot(R_1, method = "circle")
```
Interpretation
After visualizing the loading matrices and visualizing them with corrplots, we believe that oblique rotation would not be necessary for this particular data set as the orthogonal rotation and oblique rotation look exactly the same, we no notable differences with complex dimensions. With this in mind, we will be using orthogonal rotation for this data set

### 12. Variance Explained and Scree Plot
```{r}
#Variance 
Var <- (EigX$values / sum(EigX$values)) * 100
Var

Var <- (EigY$values / sum(EigY$values)) * 100
Var
```

### 12.1
```{r}
CummulVar_f2 <- Var[1] + Var[2]
CummulVar_f2
# Scree Plot 
plot(EigX$values, type = "b", main = "Scree Plot", 
     xlab = "Component", ylab = "Eigenvalue")
```

### 12.2
```{r}
# Communalities
communalities <- rowSums(R^2)
communalities
```
PCA Interpretation Summary
Interperting Variance and Covariance: The PCA indicated that several variables were well accounted for by the extracted components, with particulary high communalities for Dietary Habits (0.75), Family History of Mental Illness (0.71), Academic Pressure (0.62), Gender (0.58), and Financial Stress (0.53). Examination of the rotated solution revealed a clear and interpretable three-factor structure: Depression loaded almost entirely on RC1 (0.9986), Study Satisfaction showed a near-perfect loading on RC3 (0.9987), and Sleep Duration loaded almost exclusively on RC2 (0.9999). These strong, isolated loadings demonstate that each construct forms a distinct and statistically robust component within the dataset.



